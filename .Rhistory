temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels    <- count(temp3$MCD)$x
yLabels    <- sample(yLabels, size=min(6, length(yLabels)))  
yAt        <- yLabels
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(col=plotLayout[i,'aCol'], row=plotLayout[i,'aRow'], ncol=2, nrow=2)),
newpage=plotLayout[i,'more'])
Sys.sleep(1)
}
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), more=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels    <- count(temp3$MCD)$x
yLabels    <- sample(yLabels, size=min(6, length(yLabels)))  
yAt        <- yLabels
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(col=plotLayout[i,'aCol'], row=plotLayout[i,'aRow'], ncol=2, nrow=2),
newpage=plotLayout[i,'more'])
Sys.sleep(1)
}
warnings()
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(col=plotLayout[i,'aCol'], row=plotLayout[i,'aRow'], ncol=2, nrow=2),
newpage=plotLayout[i,'more'])
plotLayout
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), more=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(col=plotLayout[i,'aCol'], row=plotLayout[i,'aRow'], ncol=2, nrow=2),
newpage=plotLayout[i,'more'])
Sys.sleep(1)
}
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), more=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(col=plotLayout[i,'aCol']-1, row=plotLayout[i,'aRow']-1, ncol=2, nrow=2),
newpage=plotLayout[i,'more'])
Sys.sleep(1)
}
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), more=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'more'])
Sys.sleep(1)
}
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), more=rep(c(F,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'more'])
Sys.sleep(1)
}
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), more=rep(c(F,F,F,T), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'more'])
Sys.sleep(1)
}
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), newpage=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'newpage'])
Sys.sleep(1)
}
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), newpage=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'newpage'])
print(plotLayout[i,])
Sys.sleep(1)
}
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), newpage=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'newpage'])
print(plotLayout[i,])
i = i + 1
Sys.sleep(1)
}
sort(table(tallDat$underlying_cause), decreasing=TRUE)
pdf(file='MCD Paths from the New York Data Set.pdf', width=11, height=8.5)
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), newpage=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'newpage'])
i = i + 1
Sys.sleep(1)
}
dev.off()
dev.off()
pdf(file='MCD Paths from the New York Data Set.pdf', width=11, height=8.5)
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), newpage=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=1,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'newpage'])
i = i + 1
}
dev.off()
xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=paste('Cases with underlying_cause:', codName, sep='\n'),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=0.8,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?');
xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=list(paste('Cases with underlying_cause:', codName, sep='\n'), cex=0.8),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=0.8,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=list(paste('Cases with underlying_cause:', codName, sep='\n'), cex=0.8),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=0.8, alpha=0.6,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
head(smallDat)
table(smallDat$data_year)
pdf(file='MCD Paths from the New York Data Set.pdf', width=11, height=8.5)
i <- 1
plotLayout <- data.frame(aCol=rep(1:2, times=20), aRow=rep(c(1,1,2,2), times=5), newpage=rep(c(T,F,F,F), times=5))
for (aCause in names(sort(table(tallDat$underlying_cause), decreasing=TRUE))[1:20]) {
#aCause = '4280'
idBucket   <- with(smallDat, unique(id[ underlying_cause == aCause ]))    # everyone who has this gs_text
temp3      <- subset(tallDat, subset = ((id %in% idBucket)))
yLabels <- as.character(count(temp3$MCD)$x)
yLabels <- sample(yLabels, size=min(5,length(yLabels)))  
yAt     <- match(yLabels, levels(temp3$MCD)) 
ageGroups   <- cut(temp3$age, breaks=c(-2,2,16,50,200), labels=c('Infant', 'Child', 'Adult', 'Senior'))  
colGroups   <- c('blue', 'red')[temp3$sex] 
pointGroups <- c(49:52)[as.numeric(ageGroups)]     # pch=48:57  are '0' -> '9'
codName     <- paste(substr(unlist(strsplit(icdGuess(aCause), split=' \\| ')), 1, 50), collapse=' -or-\n')
codName     <- gsub('\\? ', '', codName)
aPlot = xyplot(as.numeric(MCD) ~ jitter(time, amount=0.1), groups=id, data=temp3, type=c('b','g'),
main=list(paste('Cases with underlying_cause:', codName, sep='\n'), cex=0.8),
sub=list('\nBlue=male, Red=Female\n1=Infant, 2=Child, 3=Adult, 4=Senior', cex=0.7),
col=colGroups, pch=pointGroups, cex=0.8, alpha=0.6,
scales=list(y=list(at=yAt, labels=yLabels, relation='same')),
xlab='< < <== Direction of Causality', ylab='ICD-9 Code?'); # bringToTop()
print(aPlot, split=list(plotLayout[i,'aCol'], plotLayout[i,'aRow'], 2, 2),
newpage=plotLayout[i,'newpage'])
i = i + 1
}
dev.off()
rm(list=ls())
q()
rm(list=ls())
setwd('C:/Users/John/Desktop/DeathCertificates/')
#library(jsonlite)     # .JSON files
#library(RJSONIO)
#library(gdata)        # Excel files
library(lattice)
library(latticeExtra)
library(plyr)
library(gplots)
library(gtools)       # smartbind  (to bind dfs with different columns)
#library(RWeka)        # Various machine learning implementations
library(expm)         # matrix exponentiation
source('GC Methods.R')
# -----------------------------------------------
# Start by reading in the Mexico death certificate data.   This supposedly has the data from 1589 Mexican
# subjects.   These are 'gold standard' reviewed documents and 224 of them are noted as being garbage codes.
# Prep the data in the other script file, 'DeathCertificates_Basic_Data_Shaping_and_Storage.R'
load(file='dat.RData')          # Load the (1587x67) data as processed in earlier
load(file='icd10Vec.RData')     # 91,737 ICD-10 definitions
load(file='colDesc.RData')      # Descriptions of the column headers (547 headers as a named vector)
source('GC Methods.R')
someIds <- sample(dat$sid[dat$icd_name != '_gc'])
dat[dat$sid %in% someIds[10:15], goodCols]
probObj  <- getMCDTransitionMatrix(x=dat[dat$sid %in% someIds,],
mcdCols=c("gs_text", "codcau11", "codcau21", "codcau31", "codcau41", "codcau51"))
str(probObj)
results  <- bayesCompute(evidence=c("I64", "K766", "K709", "F102"), probObj);  str(results)
tail(sort(results$eStepVec))
tail(sort(results$eGlobalVec))
goodCols <- c(1,4,10,12:17, which(names(dat) %in% c("age", "gender", "education", "cigsPerDay")))
dat[dat$sid %in% someIds[10:15], goodCols]
bestCall <- function(x, ...) { 
result = bayesCompute(evidence=x, ...)$eGlobalVec
return(names(sort(result, decreasing=TRUE))[1])
}
mcdCols=c("codcau11", "codcau21", "codcau31", "codcau41", "codcau51")
bestCall(dat[60, mcdCols], probObj=probObj)
datBayes <- ddply(dat[sample(nrow(dat),100), goodCols], .(sid), mutate, 
eGlobal=bestCall(x=c(codcau11, codcau21, codcau31, codcau41, codcau51), probObj=probObj))
datBayes
probObj$codVec
probObj  <- getMCDTransitionMatrix(x=dat[dat$sid %in% someIds,],
mcdCols=c("gs_text", "causadef", "codcau11", "codcau21", "codcau31", "codcau41", "codcau51"))
str(probObj)
results  <- bayesCompute(evidence=c("I64", "K766", "K709", "F102"), probObj);  str(results)
tail(sort(results$eStepVec))
tail(sort(results$eGlobalVec))
mcdCols=c("causadef", "codcau11", "codcau21", "codcau31", "codcau41", "codcau51")
bestCall(dat[60, mcdCols], probObj=probObj)
datBayes <- ddply(dat[sample(nrow(dat),100), goodCols], .(sid), mutate, 
eGlobal=bestCall(x=c(codcau11, codcau21, codcau31, codcau41, codcau51), probObj=probObj))
datBayes
probObj$codVec
probObj$Q['P95',]
tail(sort(probObj$Q['P95',]))
results  <- bayesCompute(evidence=c("P95"), probObj);  str(results)
tail(sort(results$eStepVec))
tail(sort(results$eGlobalVec))
datBayes <- ddply(dat[sample(nrow(dat),100), goodCols], .(sid), mutate, 
eGlobal=bestCall(x=c(causadef, codcau11, codcau21, codcau31, codcau41, codcau51), probObj=probObj))
datBayes
datBayes[order(datBayes$icd_name),]
results  <- bayesCompute(evidence=c("Y094", "S069", "S099", "Y044"), probObj);  str(results)
tail(sort(results$eStepVec))
tail(sort(results$eGlobalVec))
evidence=c("Y094", "S069", "S099", "Y044")
icdGuess(evidence)
plot(tail(sort(results$eGlobalVec)))
tail(sort(results$eGlobalVec))
barplot(tail(sort(results$eGlobalVec)))
args(barplot)
?barplot
barplot(head(sort(results$eGlobalVec, decreasing=TRUE)))
barplot(head(sort(results$eGlobalVec, decreasing=TRUE))); grid()
head(datBayes)
showBayesCompute <- function(bayesDatObj) {
old.par <- par()
par(mfrow=c(2,1))
barplot(sort(bayesDatObj$eStepVec[bayesDatObj$eStepVec >0], decreasing=TRUE)); grid()
barplot(sort(bayesDatObj$eGlobalVec[bayesDatObj$eStepVec >0], decreasing=TRUE)); grid()
cat('\nThe MCD trail is as follows:\n------------------------\n')
for (i in 1:length(bayesDatObj$evidence))
cat(i, bayesDatObj$evidence, icdGuess(bayesDatObj$evidence), '\n')
}
par() <- old.par
}
showBayesCompute <- function(bayesDatObj) {
old.par <- par()
par(mfrow=c(2,1))
barplot(sort(bayesDatObj$eStepVec[bayesDatObj$eStepVec >0], decreasing=TRUE)); grid()
barplot(sort(bayesDatObj$eGlobalVec[bayesDatObj$eStepVec >0], decreasing=TRUE)); grid()
cat('\nThe MCD trail is as follows:\n------------------------\n')
for (i in 1:length(bayesDatObj$evidence)) {
cat(i, bayesDatObj$evidence, icdGuess(bayesDatObj$evidence), '\n')
}
par() <- old.par
}
source('GC Methods.R')
showBayesCompute(results)
plot(1:100)
?par
source('GC Methods.R')
showBayesCompute(results)
par(new=TRUE)
plot(5:10)
par(.)
plot(5:10)
source('GC Methods.R')
showBayesCompute(results)
tail(sort(results$eGlobalVec))
tail(sort(results$eStepVec))
sort(results$eStepVec)
results$eStepVec['A049']
results$eStepVec['A049'] > 0
results$eStepVec['Y839']
results$eStepVec['Y839'] > 0
source('GC Methods.R')
showBayesCompute(results)
source('GC Methods.R')
showBayesCompute(results)
barplot(head(sort(results$eGlobalVec, decreasing=TRUE)), srt=45); grid()
barplot(head(sort(results$eGlobalVec, decreasing=TRUE)), crt=45); grid()
?barplot
barplot(head(sort(results$eGlobalVec, decreasing=TRUE)), las=2); grid()
source('GC Methods.R')
showBayesCompute(results)
source('GC Methods.R')
showBayesCompute(results)
source('GC Methods.R')
showBayesCompute(results)
str(results)
source('GC Methods.R')
source('GC Methods.R')
showBayesCompute(results)
bayesDatObj = results
source('GC Methods.R')
showBayesCompute(results)
length(bayesDatObj$dropEnv)
bayesDatObj$dropEnv
source('GC Methods.R')
showBayesCompute(results)
source('GC Methods.R')
showBayesCompute(results)
results  <- bayesCompute(evidence=c("C924","J960","R048","C924"), probObj);  str(results)
showBayesCompute(results)
barplot(head(sort(results$eGlobalVec, decreasing=TRUE)), cex=0.5); grid()
args(barplot)
barplot(head(sort(results$eGlobalVec, decreasing=TRUE)), cex.names=0.5); grid()
source('GC Methods.R')
showBayesCompute(results)
source('GC Methods.R')
showBayesCompute(results)
q()
